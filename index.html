<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rolling the Dice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        body {
            height: 100vh;

            display: flex;
            justify-content: center;
            align-items: center;

            background-color: #19222B;
        }
        canvas {
            width: min(100vw, 100vh);
            height: min(100vw, 100vh);

            image-rendering: pixelated;
        }
        #roll {
            position: fixed;
            bottom: 20px;
            transform: translateX(-50%, -50%);

            width: 20dvw;
            height: auto;
            
            image-rendering: pixelated;

            cursor: pointer;
        }
        #roll:hover {
            scale: 1.1;
        }
    </style>
</head>
<body>
    <canvas id="animation" width="144" height="144"></canvas>
    <canvas id="roll" width="37" height="17" onclick="rollDice();"></button>


    <script>
        const canvas = document.getElementById('animation');
        const ctx = canvas.getContext('2d');
        const roll = document.getElementById('roll');
        const roll_ctx = roll.getContext('2d');

        let lastDrawTime = 0;
        let index = 0;
        let animation = 5;

        // roll 버튼 그리기
        const img = new Image();
        img.src = './res/roll.png';
        img.onload = () => {
            roll_ctx.drawImage(img, 0, 0);
        }
        
        // 이미지들 미리 로딩해두기
        const rollImages = Array.from({ length: 8 }, (_, i) => {
            return Array.from({ length: 50 }, (_, j) => {
                const img = new Image();
                img.src = `./res/roll/${String(i).padStart(3, '0')}/${String(j + 1).padStart(4, '0')}.png`;
                return img;
            });
        });

        function drawImage(index) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.drawImage(rollImages[animation][index], 0, 0);
        }

        function animate() {
            const drawInterval = 1000 / 30;
            let currentTime = performance.now();
            let elapsedTime = currentTime - lastDrawTime;

            if (elapsedTime > drawInterval) {
                lastDrawTime = currentTime;
                if (index >= 49) {
                    return;
                } else {
                    index += 1;
                }
                drawImage(index);
            }

            requestAnimationFrame(animate);
        }

        function rollDice() {
            index = 0;
            animation = Math.floor(Math.random() * 7);
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>